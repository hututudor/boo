(()=>{var ae=Object.defineProperty;var s=(e,t)=>{for(var r in t)ae(e,r,{get:t[r],enumerable:!0})};var d=(e,t,r)=>new Promise((a,i)=>{var p=f=>{try{c(r.next(f))}catch(x){i(x)}},l=f=>{try{c(r.throw(f))}catch(x){i(x)}},c=f=>f.done?a(f.value):Promise.resolve(f.value).then(p,l);c((r=r.apply(e,t)).next())});var m=()=>{let e=document.getElementsByClassName("book_card-image");for(let t of e){if(!t.dataset.src){console.warn("book without source found");continue}t.style.backgroundImage=`url(${t.dataset.src})`}};var E=()=>{let e=document.getElementsByClassName("form-file");for(let t of e){let r=t.getElementsByTagName("input")[0];if(!t.getElementsByTagName("input")[0]){console.error("file input not found");return}if(!t.getElementsByTagName("div")[0]){console.error("file display not found");return}t.addEventListener("click",de),r.addEventListener("change",ie)}},ie=e=>{let t=e.currentTarget.parentElement,r=t.getElementsByTagName("div")[0],a=t.getElementsByTagName("input")[0];r.innerHTML=a.files[0].name},de=e=>{e.currentTarget.getElementsByTagName("input")[0].click()};var o=()=>{document.getElementsByTagName("nav")[0].getElementsByTagName("button")[0].addEventListener("click",le)},me=()=>document.getElementsByTagName("aside")[0].classList.contains("side__show"),le=()=>{me()?ue():ce()},ce=()=>{document.getElementsByTagName("aside")[0].classList.add("side__show"),document.getElementsByTagName("nav")[0].getElementsByTagName("i")[0].style.transform="rotateZ(180deg)"},ue=()=>{document.getElementsByTagName("aside")[0].classList.remove("side__show"),document.getElementsByTagName("nav")[0].getElementsByTagName("i")[0].style.transform="rotateZ(0)"};var Z=()=>{let e=z();if(!e){console.warn("no loading element on this page");return}e.classList.contains("loading__hidden")&&e.classList.remove("loading__hidden")},Y=()=>{let e=z();if(!e){console.warn("no loading element on this page");return}e.classList.contains("loading__hidden")||e.classList.add("loading__hidden")},z=()=>document.getElementById("loading");var n=(e,t)=>{e.parentNode.querySelector("span").innerHTML=t};var v=e=>{e.disabled=!0},h=e=>{e.disabled=!1};var y=(e,t)=>{e.querySelector("div[id=error]").innerHTML=t};var I={};s(I,{load:()=>pe});var pe=()=>{o()};var L={};s(L,{load:()=>fe});var fe=()=>{o(),m()};var N={};s(N,{load:()=>ge});var ge=()=>{o(),E()};var k={};s(k,{load:()=>Ee});var Ee=()=>{o(),m()};var _={};s(_,{load:()=>ve});var ve=()=>{o(),E()};var S={};s(S,{load:()=>he});var he=()=>{o(),m()};var F={};s(F,{load:()=>ye});var ye=()=>{o()};var P={};s(P,{load:()=>be});var be=()=>{o(),m()};var A={};s(A,{load:()=>we});var Q=e=>d(void 0,null,function*(){return new Promise(t=>setTimeout(t,e))});var we=()=>d(void 0,null,function*(){o(),m(),yield Q(1e3)});var C={};s(C,{load:()=>Be});var Be=()=>{o()};var q={};s(q,{load:()=>Te});var Te=()=>{o()};var O={};s(O,{load:()=>xe});var xe=()=>{o(),m()};var D={};s(D,{load:()=>Ne});var V="http://localhost:8000/www/server";var X=r=>d(void 0,[r],function*({email:e,password:t}){let a=yield fetch(`${V}/auth/login`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),i=yield a.json();if(!a.ok)throw i;return i}),ee=a=>d(void 0,[a],function*({email:e,name:t,password:r}){let i=yield fetch(`${V}/auth/register`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:t,email:e,password:r})}),p=yield i.json();if(!i.ok)throw p;return p});var b=e=>/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(e);var te=e=>{if(e.split(".").length!==3)throw new Error("token is invalid");let[,t]=e.split(".");return JSON.parse(atob(t))};var $="token",Ie=()=>{let e=localStorage.getItem($);if(!e)return!1;try{te(e)}catch(t){return Le(),!1}return!0};var w=()=>{Ie()&&oe()};var B=e=>{e&&(localStorage.setItem($,e),oe())},Le=()=>{localStorage.removeItem($),goTo("./login")},oe=()=>goTo("./home");var g={emailTouched:!1,passwordTouched:!1},Ne=()=>{w(),ke()},ke=()=>{let e=document.getElementById("email");e.addEventListener("keyup",J),e.addEventListener("blur",re("email")),e.addEventListener("blur",J);let t=document.getElementById("password");t.addEventListener("keyup",j),t.addEventListener("blur",re("password")),t.addEventListener("blur",j),document.getElementsByTagName("form")[0].addEventListener("submit",_e)},_e=e=>d(void 0,null,function*(){if(e.preventDefault(),Se(),![J,j].map(l=>l()).every(l=>!!l))return;let r=document.querySelector('button[type="submit"]'),a=document.getElementById("email"),i=document.getElementById("password"),p=document.getElementsByTagName("form")[0];v(r);try{let{token:l}=yield X({email:a.value,password:i.value});B(l)}catch(l){y(p,l.message)}finally{h(r)}}),J=()=>{if(!g.emailTouched)return!0;let e=document.getElementById("email");return e.value?b(e.value)?(n(e,""),!0):(n(e,"Email must be valid"),!1):(n(e,"Email is required"),!1)},j=()=>{if(!g.passwordTouched)return!0;let e=document.getElementById("password");return e.value?(n(e,""),!0):(n(e,"Password is required"),!1)},Se=()=>{g.emailTouched=!0,g.passwordTouched=!0},re=e=>()=>{let t=`${e}Touched`;g[t]=!0};var H={};s(H,{load:()=>Fe});var Fe=()=>{o()};var R={};s(R,{load:()=>Pe});var u={nameTouched:!1,emailTouched:!1,passwordTouched:!1,confirmPasswordTouched:!1},Pe=()=>{w(),Ae()},Ae=()=>{let e=document.getElementById("name");e.addEventListener("keyup",K),e.addEventListener("blur",T("name")),e.addEventListener("blur",K);let t=document.getElementById("email");t.addEventListener("keyup",M),t.addEventListener("blur",T("email")),t.addEventListener("blur",M);let r=document.getElementById("password");r.addEventListener("keyup",W),r.addEventListener("blur",T("password")),r.addEventListener("blur",W);let a=document.getElementById("confirmPassword");a.addEventListener("keyup",G),a.addEventListener("blur",T("confirmPassword")),a.addEventListener("blur",G),document.getElementsByTagName("form")[0].addEventListener("submit",Ce)},Ce=e=>d(void 0,null,function*(){if(e.preventDefault(),qe(),![K,M,W,G].map(c=>c()).every(c=>!!c))return;let r=document.querySelector('button[type="submit"]'),a=document.getElementById("name"),i=document.getElementById("email"),p=document.getElementById("password"),l=document.getElementsByTagName("form")[0];v(r);try{let{token:c}=yield ee({name:a.value,email:i.value,password:p.value});B(c)}catch(c){y(l,c.message)}finally{h(r)}}),K=()=>{if(!u.nameTouched)return!0;let e=document.getElementById("name");return e.value?(n(e,""),!0):(n(e,"Name is required"),!1)},M=()=>{if(!u.emailTouched)return!0;let e=document.getElementById("email");return e.value?b(e.value)?(n(e,""),!0):(n(e,"Email must be valid"),!1):(n(e,"Email is required"),!1)},W=()=>{if(!u.passwordTouched)return!0;let e=document.getElementById("password");return e.value?(n(e,""),!0):(n(e,"Password is required"),!1)},G=()=>{if(!u.confirmPasswordTouched)return!0;let e=document.getElementById("confirmPassword"),t=e.value;return t?document.getElementById("password").value!==t?(n(e,"Password confirmation is incorrect"),!1):(n(e,""),!0):(n(e,"Confirm Password is required"),!1)},qe=()=>{u.nameTouched=!0,u.emailTouched=!0,u.passwordTouched=!0,u.confirmPasswordTouched=!0},T=e=>()=>{let t=`${e}Touched`;u[t]=!0};var U={};s(U,{load:()=>Oe});var Oe=()=>{o()};var ne={about:I,book:L,books_add:N,books_author:k,books_edit:_,books_genre:S,books_manager:F,books_search:P,books:A,help_questions:C,help:q,home:O,login:D,profile:H,register:R,reviews:U};var se=()=>d(void 0,null,function*(){let e=Ve();if(!e){console.error("** PAGE UNKNOWN! Please add meta tag **");return}let t=ne[e];if(!t){console.error(`** PAGE CONFIG UNKNOWN! Page: ${e} **`);return}Z(),yield t.load(),Y()}),Ve=()=>{var e;return(e=document.querySelector('meta[name="page-name"]'))==null?void 0:e.getAttribute("content")};document.addEventListener("DOMContentLoaded",se);})();
//# sourceMappingURL=app.js.map
